{% extends "base.html" %}
{% block content %}
  <!-- Page Header -->
  <div class="page-header">
    <h1 class="page-title page-title-animated">ðŸ“‹ My Job Listings</h1>
    <p class="page-subtitle page-subtitle-animated">View your posted opportunities and see who has expressed interest</p>
  </div>

  <!-- Information Blurb -->
  <div class="info-blurb">
    <div class="info-content">
      <div class="info-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="info-text">
        <h3>ðŸ’¡ Pro Tip</h3>
        <p>We encourage radiologists to share relevant information including their resume, job expectations, and availability when contacting you. This helps facilitate your selection process and allows you to make more informed decisions about potential candidates.</p>
      </div>
    </div>
  </div>

  <!-- Post New Opportunity Button -->
  <div class="submit-section">
    <a href="/opportunities/new" class="submit-btn">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Post New Opportunity
    </a>
  </div>

  <!-- Job Listings Section -->
  <div class="data-section">
    <div class="data-header">
      <h2 class="data-title">Your Opportunities</h2>
      <p class="data-subtitle">{{ listings_data|length }} listing{{ 's' if listings_data|length != 1 else '' }} posted</p>
    </div>

    {% if listings_data %}
    <div class="listings-grid">
      {% for listing in listings_data %}
      <div class="listing-card">
        <div class="listing-header">
          <div class="listing-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 13.255A23.931 23.931 0 0 1 12 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2-2v2m8 0V6a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V4m8 0v2a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V4m8 0v2a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="listing-title">
            <h3 class="opportunity-title">{{ listing.opportunity.title }}</h3>
            <p class="opportunity-location">{{ listing.opportunity.city }}, {{ listing.opportunity.state }} Â· {{ listing.opportunity.opportunity_type.value|replace('_',' ') }}</p>
          </div>
        </div>
        
        <div class="listing-details">
          <div class="detail-row">
            <span class="detail-label">Pay Rate</span>
            <span class="detail-value">${{ listing.opportunity.pay_amount }}{% if listing.opportunity.pay_type %}{% if listing.opportunity.pay_type.value == 'per_hour' %}/hr{% elif listing.opportunity.pay_type.value == 'per_rvu' %}/RVU{% endif %}{% else %}/hr{% endif %}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Job Type</span>
            <span class="detail-value">{{ listing.opportunity.opportunity_type.value|replace('_',' ') }}</span>
          </div>
        </div>
        
        <div class="listing-actions">
          <a href="/opportunities/{{ listing.opportunity.id }}/edit" class="btn edit">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Edit
          </a>
          <a href="/opportunities/{{ listing.opportunity.id }}" class="btn secondary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            View Details
          </a>
          <a href="/opportunities/{{ listing.opportunity.id }}/calendar" class="btn calendar">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Calendar
          </a>
        </div>
        
        {% if listing.residents %}
        <div class="interested-section">
          <h4 class="section-title">Interested Radiologists ({{ listing.residents|length }})</h4>
          
          <div class="residents-grid">
            {% for resident_data in listing.residents %}
            <div class="resident-card">
              <div class="resident-header">
                <div class="resident-avatar">
                  {% if resident_data.profile and resident_data.profile.photo_filename %}
                    <img src="/uploads/{{ resident_data.profile.photo_filename }}" alt="{{ resident_data.user.name }}" class="avatar-image">
                  {% else %}
                    <div class="avatar-fallback">
                      {{ resident_data.user.name[0].upper() }}
                    </div>
                  {% endif %}
                </div>
                <div class="resident-info">
                  <h5 class="resident-name">
                    <a href="/profile/{{ resident_data.user.id }}" class="resident-link">{{ resident_data.user.name }}</a>
                  </h5>
                  <p class="resident-email">
                    <a href="mailto:{{ resident_data.user.email }}" class="email-link">{{ resident_data.user.email }}</a>
                  </p>
                  {% if resident_data.profile %}
                    {% if resident_data.profile.training_year %}
                      <p class="resident-training">{{ resident_data.profile.training_year.value }}</p>
                    {% endif %}
                    {% if resident_data.profile.residency_program %}
                      <p class="resident-program">{{ resident_data.profile.residency_program }}</p>
                    {% endif %}
                  {% endif %}
                  {% if resident_data.last_message %}
                    <p class="last-message">Last message: <span data-timestamp="{{ resident_data.last_message.created_at.isoformat() }}" data-format="full">{{ resident_data.last_message.created_at.strftime('%B %d, %Y at %I:%M %p') }}</span></p>
                  {% endif %}
                </div>
              </div>
              
              <div class="resident-actions">
                <a href="/profile/{{ resident_data.user.id }}" class="btn secondary small">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Profile
                </a>
                <a href="/messages/{{ resident_data.conversation_id }}" class="btn primary small">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Message
                </a>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% else %}
        <div class="no-interest">
          <div class="no-interest-content">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <p>No radiologists have contacted you about this opportunity yet.</p>
          </div>
        </div>
        {% endif %}
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
      <div class="empty-icon">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21 13.255A23.931 23.931 0 0 1 12 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2-2v2m8 0V6a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V4m8 0v2a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V4m8 0v2a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h3>No opportunities posted yet</h3>
      <p>You haven't posted any opportunities yet.</p>
      <div class="empty-actions">
        <a href="/opportunities/new" class="btn primary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Post Your First Opportunity
        </a>
      </div>
    </div>
    {% endif %}
  </div>

<style>
  /* Page Header */
  .page-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .page-title {
    font-size: 3rem;
    font-weight: 900;
    margin-bottom: 1rem;
    background: linear-gradient(135deg, var(--text) 0%, var(--accent) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .page-subtitle {
    font-size: 1.25rem;
    color: var(--text-secondary);
    font-weight: 300;
  }

  /* Information Blurb */
  .info-blurb {
    margin-bottom: 2rem;
  }

  .info-content {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    background: var(--glass);
    backdrop-filter: var(--blur);
    -webkit-backdrop-filter: var(--blur);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: var(--shadow);
  }

  .info-icon {
    width: 48px;
    height: 48px;
    background: var(--accent-light);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--accent);
    flex-shrink: 0;
  }

  .info-text h3 {
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--text);
    margin: 0 0 0.5rem 0;
  }

  .info-text p {
    color: var(--text-secondary);
    font-size: 0.95rem;
    line-height: 1.6;
    margin: 0;
  }

  /* Submit Section */
  .submit-section {
    text-align: center;
    margin-bottom: 3rem;
  }

  .submit-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    background: var(--accent);
    color: white;
    font-weight: 600;
    padding: 1rem 2rem;
    border-radius: 12px;
    text-decoration: none;
    transition: all 0.3s ease;
    box-shadow: var(--shadow);
  }

  .submit-btn:hover {
    background: var(--accent-dark);
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  /* Data Section */
  .data-section {
    margin-bottom: 3rem;
  }

  .data-header {
    text-align: center;
    margin-bottom: 2rem;
  }

  .data-title {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 0.5rem;
  }

  .data-subtitle {
    color: var(--text-secondary);
    font-size: 1rem;
  }

  /* Listings Grid */
  .listings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 1rem;
  }

  .listing-card {
    background: var(--glass);
    backdrop-filter: var(--blur);
    -webkit-backdrop-filter: var(--blur);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 1rem;
    box-shadow: var(--shadow);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }

  .listing-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--accent) 0%, var(--accent-light) 100%);
    border-radius: 12px 12px 0 0;
  }

  .listing-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-lg);
    border-color: var(--accent);
  }

  .listing-header {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    margin-bottom: 1rem;
  }

  .listing-icon {
    width: 36px;
    height: 36px;
    background: var(--accent-light);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--accent);
    flex-shrink: 0;
  }

  .listing-title {
    flex: 1;
  }

  .opportunity-title {
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 0.25rem;
  }

  .opportunity-location {
    color: var(--text-secondary);
    font-size: 0.875rem;
    margin: 0;
  }

  .listing-details {
    margin-bottom: 1rem;
  }

  .detail-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--glass-border-light);
  }

  .detail-row:last-child {
    border-bottom: none;
  }

  .detail-label {
    font-weight: 600;
    color: var(--text-secondary);
    font-size: 0.8rem;
  }

  .detail-value {
    font-weight: 600;
    color: var(--text);
    font-size: 0.8rem;
  }

  .listing-actions {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
    font-size: 0.875rem;
  }

  .btn.primary {
    background: var(--accent);
    color: white;
  }

  .btn.primary:hover {
    background: var(--accent-dark);
    transform: translateY(-2px);
  }

  .btn.secondary {
    background: var(--glass);
    border: 1px solid var(--glass-border);
    color: var(--text);
  }

  .btn.secondary:hover {
    background: var(--accent-light);
    border-color: var(--accent);
    transform: translateY(-2px);
  }

  .btn.calendar {
    background: rgba(45, 212, 191, 0.2);
    color: var(--accent);
    border: 1px solid var(--accent);
  }

  .btn.calendar:hover {
    background: var(--accent);
    color: white;
    transform: translateY(-2px);
  }

  .btn.edit {
    background: rgba(255, 193, 7, 0.2);
    color: #ffc107;
    border: 1px solid #ffc107;
  }

  .btn.edit:hover {
    background: #ffc107;
    color: white;
    transform: translateY(-2px);
  }

  .btn.small {
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
  }

  /* Interested Section */
  .interested-section {
    padding-top: 1rem;
    border-top: 1px solid var(--glass-border-light);
  }

  .section-title {
    font-size: 1rem;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 1rem;
  }

  .residents-grid {
    display: grid;
    gap: 0.75rem;
  }

  .resident-card {
    background: var(--glass-light);
    border: 1px solid var(--glass-border-light);
    border-radius: 8px;
    padding: 1rem;
  }

  .resident-header {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
  }

  .resident-avatar {
    flex-shrink: 0;
  }

  .avatar-image {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    object-fit: cover;
  }

  .avatar-fallback {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--accent);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 14px;
    font-weight: 600;
  }

  .resident-info {
    flex: 1;
  }

  .resident-name {
    font-size: 1rem;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 0.25rem;
  }

  .resident-email {
    margin-bottom: 0.25rem;
  }

  .resident-link {
    color: var(--accent);
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .resident-link:hover {
    color: var(--accent-dark);
  }

  .email-link {
    color: var(--accent);
    text-decoration: none;
    font-weight: 600;
    font-size: 0.9rem;
    transition: color 0.3s ease;
  }

  .email-link:hover {
    color: var(--accent-dark);
    text-decoration: underline;
  }

  .resident-training {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 0.25rem;
  }

  .resident-program {
    color: var(--text-secondary);
    font-size: 0.875rem;
    margin-bottom: 0.5rem;
  }

  .last-message {
    color: var(--text-secondary);
    font-size: 0.8rem;
    margin: 0;
  }

  .resident-actions {
    display: flex;
    gap: 0.375rem;
  }

  /* No Interest */
  .no-interest {
    padding-top: 1rem;
    border-top: 1px solid var(--glass-border-light);
  }

  .no-interest-content {
    display: flex;
    align-items: center;
    gap: 1rem;
    color: var(--text-secondary);
    font-size: 0.95rem;
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: var(--glass);
    backdrop-filter: var(--blur);
    -webkit-backdrop-filter: var(--blur);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
  }

  .empty-icon {
    width: 80px;
    height: 80px;
    background: var(--accent-light);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 2rem;
    color: var(--accent);
  }

  .empty-state h3 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 1rem;
  }

  .empty-state p {
    color: var(--text-secondary);
    font-size: 1rem;
    margin-bottom: 2rem;
  }

  .empty-actions {
    display: flex;
    justify-content: center;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .page-title {
      font-size: 2.5rem;
    }

    .listings-grid {
      grid-template-columns: 1fr;
    }

    .listing-header {
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 1rem;
    }

    .listing-actions {
      flex-direction: column;
      align-items: stretch;
    }

    .btn {
      justify-content: center;
    }

    .resident-header {
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 1rem;
    }

    .resident-actions {
      flex-direction: column;
      align-items: stretch;
    }
  }
</style>
{% endblock %}

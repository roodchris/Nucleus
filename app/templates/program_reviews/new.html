{% extends "base.html" %}
{% block content %}
<!-- Page Header -->
<div class="page-header">
  <h1 class="page-title page-title-animated">üè• Write a Program Review</h1>
  <p class="page-subtitle page-subtitle-animated">Share your experience with a medical residency program to help future residents make informed decisions</p>
</div>

<div class="card max-w-4xl mx-auto">
  <h3 class="text-2xl font-bold mb-4">Program Review</h3>
  <p class="text-secondary mb-8 text-lg leading-relaxed">
    Your review will help future medical residents choose the right program for their career goals.
  </p>
  
  <form method="POST" class="space-y-8">
    <!-- Program Selection -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon">üè•</div>
        <div class="card-title">Program Information</div>
      </div>
      <div class="form-grid">
        <div>
          <label for="program_name" class="block text-sm font-medium mb-2">Program *</label>
          <select name="program_name" id="program_name" class="input" required>
            <option value="">Choose a program...</option>
            {% if form_data and form_data.program_name %}
            <option value="{{ form_data.program_name }}" selected>{{ form_data.program_name }}</option>
            {% endif %}
            <!-- Programs will be loaded dynamically via JavaScript -->
          </select>
          <div class="info-box">
            <p class="text-sm">Select the medical residency program you're reviewing</p>
          </div>
        </div>
        <div>
          <label for="specialty" class="block text-sm font-medium mb-2">Medical Specialty (Optional)</label>
          <select name="specialty" id="specialty" class="input">
            <option value="" {% if not form_data or not form_data.specialty %}selected{% endif %}>General (All Specialties)</option>
            <option value="non_clinical_other" {% if form_data and form_data.specialty == 'non_clinical_other' %}selected{% endif %}>Non-clinical/Other</option>
            <option value="aerospace_medicine" {% if form_data and form_data.specialty == 'aerospace_medicine' %}selected{% endif %}>Aerospace Medicine</option>
            <option value="anesthesiology" {% if form_data and form_data.specialty == 'anesthesiology' %}selected{% endif %}>Anesthesiology</option>
            <option value="child_neurology" {% if form_data and form_data.specialty == 'child_neurology' %}selected{% endif %}>Child Neurology</option>
            <option value="dermatology" {% if form_data and form_data.specialty == 'dermatology' %}selected{% endif %}>Dermatology</option>
            <option value="emergency_medicine" {% if form_data and form_data.specialty == 'emergency_medicine' %}selected{% endif %}>Emergency Medicine</option>
            <option value="family_medicine" {% if form_data and form_data.specialty == 'family_medicine' %}selected{% endif %}>Family Medicine</option>
            <option value="internal_medicine" {% if form_data and form_data.specialty == 'internal_medicine' %}selected{% endif %}>Internal Medicine</option>
            <option value="medical_genetics" {% if form_data and form_data.specialty == 'medical_genetics' %}selected{% endif %}>Medical Genetics</option>
            <option value="interventional_radiology" {% if form_data and form_data.specialty == 'interventional_radiology' %}selected{% endif %}>Interventional Radiology</option>
            <option value="neurological_surgery" {% if form_data and form_data.specialty == 'neurological_surgery' %}selected{% endif %}>Neurological Surgery</option>
            <option value="neurology" {% if form_data and form_data.specialty == 'neurology' %}selected{% endif %}>Neurology</option>
            <option value="nuclear_medicine" {% if form_data and form_data.specialty == 'nuclear_medicine' %}selected{% endif %}>Nuclear Medicine</option>
            <option value="obstetrics_gynecology" {% if form_data and form_data.specialty == 'obstetrics_gynecology' %}selected{% endif %}>Obstetrics and Gynecology</option>
            <option value="occupational_environmental_medicine" {% if form_data and form_data.specialty == 'occupational_environmental_medicine' %}selected{% endif %}>Occupational and Environmental Medicine</option>
            <option value="orthopaedic_surgery" {% if form_data and form_data.specialty == 'orthopaedic_surgery' %}selected{% endif %}>Orthopaedic Surgery</option>
            <option value="otolaryngology" {% if form_data and form_data.specialty == 'otolaryngology' %}selected{% endif %}>Otolaryngology - Head and Neck Surgery</option>
            <option value="pathology" {% if form_data and form_data.specialty == 'pathology' %}selected{% endif %}>Pathology-Anatomic and Clinical</option>
            <option value="pediatrics" {% if form_data and form_data.specialty == 'pediatrics' %}selected{% endif %}>Pediatrics</option>
            <option value="physical_medicine_rehabilitation" {% if form_data and form_data.specialty == 'physical_medicine_rehabilitation' %}selected{% endif %}>Physical Medicine and Rehabilitation</option>
            <option value="plastic_surgery" {% if form_data and form_data.specialty == 'plastic_surgery' %}selected{% endif %}>Plastic Surgery</option>
            <option value="psychiatry" {% if form_data and form_data.specialty == 'psychiatry' %}selected{% endif %}>Psychiatry</option>
            <option value="radiation_oncology" {% if form_data and form_data.specialty == 'radiation_oncology' %}selected{% endif %}>Radiation Oncology</option>
            <option value="radiology_diagnostic" {% if form_data and form_data.specialty == 'radiology_diagnostic' %}selected{% endif %}>Radiology-Diagnostic</option>
            <option value="general_surgery" {% if form_data and form_data.specialty == 'general_surgery' %}selected{% endif %}>General Surgery</option>
            <option value="thoracic_surgery" {% if form_data and form_data.specialty == 'thoracic_surgery' %}selected{% endif %}>Thoracic Surgery</option>
            <option value="urology" {% if form_data and form_data.specialty == 'urology' %}selected{% endif %}>Urology</option>
            <option value="vascular_surgery" {% if form_data and form_data.specialty == 'vascular_surgery' %}selected{% endif %}>Vascular Surgery</option>
          </select>
          <div class="info-box">
            <p class="text-sm">Select the medical specialty this review is written for (optional)</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Rating Categories -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon">‚≠ê</div>
        <div class="card-title">Program Ratings</div>
      </div>
      <div class="form-grid">
        <div>
          <label for="educational_quality" class="block text-sm font-medium mb-2">Educational Quality *</label>
          <select name="educational_quality" id="educational_quality" class="input" required>
            <option value="">Select rating...</option>
            <option value="1">1 - Poor</option>
            <option value="2">2 - Below Average</option>
            <option value="3">3 - Average</option>
            <option value="4">4 - Above Average</option>
            <option value="5">5 - Excellent</option>
          </select>
          <div class="info-box">
            <p class="text-sm">Teaching quality, learning opportunities, curriculum effectiveness</p>
          </div>
        </div>

        <div>
          <label for="work_life_balance" class="block text-sm font-medium mb-2">Work-Life Balance *</label>
          <select name="work_life_balance" id="work_life_balance" class="input" required>
            <option value="">Select rating...</option>
            <option value="1">1 - Poor</option>
            <option value="2">2 - Below Average</option>
            <option value="3">3 - Average</option>
            <option value="4">4 - Above Average</option>
            <option value="5">5 - Excellent</option>
          </select>
          <div class="info-box">
            <p class="text-sm">Hours, call schedule, personal time, work-life integration</p>
          </div>
        </div>

        <div>
          <label for="attending_quality" class="block text-sm font-medium mb-2">Attending Quality *</label>
          <select name="attending_quality" id="attending_quality" class="input" required>
            <option value="">Select rating...</option>
            <option value="1">1 - Poor</option>
            <option value="2">2 - Below Average</option>
            <option value="3">3 - Average</option>
            <option value="4">4 - Above Average</option>
            <option value="5">5 - Excellent</option>
          </select>
          <div class="info-box">
            <p class="text-sm">Faculty expertise, teaching ability, mentorship quality</p>
          </div>
        </div>

        <div>
          <label for="facilities_quality" class="block text-sm font-medium mb-2">Facilities Quality *</label>
          <select name="facilities_quality" id="facilities_quality" class="input" required>
            <option value="">Select rating...</option>
            <option value="1">1 - Poor</option>
            <option value="2">2 - Below Average</option>
            <option value="3">3 - Average</option>
            <option value="4">4 - Above Average</option>
            <option value="5">5 - Excellent</option>
          </select>
          <div class="info-box">
            <p class="text-sm">Equipment quality, workspace, resources, technology</p>
          </div>
        </div>

        <div>
          <label for="research_opportunities" class="block text-sm font-medium mb-2">Research Opportunities *</label>
          <select name="research_opportunities" id="research_opportunities" class="input" required>
            <option value="">Select rating...</option>
            <option value="1">1 - Poor</option>
            <option value="2">2 - Below Average</option>
            <option value="3">3 - Average</option>
            <option value="4">4 - Above Average</option>
            <option value="5">5 - Excellent</option>
          </select>
          <div class="info-box">
            <p class="text-sm">Research support, project opportunities, publication support</p>
          </div>
        </div>

        <div>
          <label for="culture" class="block text-sm font-medium mb-2">Culture *</label>
          <select name="culture" id="culture" class="input" required>
            <option value="">Select rating...</option>
            <option value="1">1 - Poor</option>
            <option value="2">2 - Below Average</option>
            <option value="3">3 - Average</option>
            <option value="4">4 - Above Average</option>
            <option value="5">5 - Excellent</option>
          </select>
          <div class="info-box">
            <p class="text-sm">Program atmosphere, trainee camaraderie, support systems</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Additional Comments -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon">üí¨</div>
        <div class="card-title">Additional Comments</div>
      </div>
      <div class="form-grid">
        <div>
          <label for="comments" class="block text-sm font-medium mb-2">Detailed Review</label>
          <textarea name="comments" id="comments" rows="6" class="input" placeholder="Share your detailed experience, pros and cons, advice for future physicians, or any other insights...">{% if form_data and form_data.comments %}{{ form_data.comments }}{% endif %}</textarea>
          <div class="info-box">
            <p class="text-sm">Optional: Provide detailed feedback about your experience, including specific examples and advice for future residents</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Submission Options -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon">üîí</div>
        <div class="card-title">Submission Options</div>
      </div>
      <div class="form-grid">
        <div>
          <label class="flex items-center space-x-3 cursor-pointer">
            <input type="checkbox" name="anonymous" id="anonymous" class="w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2" {% if form_data and form_data.anonymous %}checked{% endif %}>
            <span class="text-sm font-medium">Submit this review anonymously</span>
          </label>
          <div class="info-box">
            <p class="text-sm">If checked, your name will not be associated with this review. Your review will still be valuable to the community while protecting your privacy.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Submit Buttons -->
    <div class="flex gap-4 justify-center">
      <button type="submit" class="btn">Submit Review</button>
      <a href="/program-reviews" class="btn btn-secondary">Cancel</a>
    </div>
  </form>
</div>

<!-- Rating Guide -->
<div class="card max-w-4xl mx-auto mt-6">
  <h3>Rating Guide</h3>
  <div class="grid-2 gap-6">
    <div>
      <h4>Rating Scale (1-5)</h4>
      <ul class="text-secondary space-y-2">
        <li>‚Ä¢ <strong>1:</strong> Poor - Significant issues</li>
        <li>‚Ä¢ <strong>2:</strong> Below Average - Some concerns</li>
        <li>‚Ä¢ <strong>3:</strong> Average - Meets basic expectations</li>
        <li>‚Ä¢ <strong>4:</strong> Above Average - Exceeds expectations</li>
        <li>‚Ä¢ <strong>5:</strong> Excellent - Outstanding quality</li>
      </ul>
    </div>
    <div>
      <h4>Tips for Good Reviews</h4>
      <ul class="text-secondary space-y-2">
        <li>‚Ä¢ Be specific about your experiences</li>
        <li>‚Ä¢ Include both positive and negative aspects</li>
        <li>‚Ä¢ Provide constructive feedback</li>
        <li>‚Ä¢ Focus on facts rather than personal opinions</li>
        <li>‚Ä¢ Consider the overall program value</li>
      </ul>
    </div>
  </div>
</div>

<style>
/* Page Header */
.page-header {
  text-align: center;
  margin-bottom: 3rem;
}

.page-title {
  font-size: 3rem;
  font-weight: 900;
  background: linear-gradient(135deg, var(--accent) 0%, #00b8e6 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 1rem;
  line-height: 1.2;
}

.page-subtitle {
  font-size: 1.25rem;
  color: var(--text-secondary);
  max-width: 600px;
  margin: 0 auto;
  line-height: 1.6;
}

@media (max-width: 768px) {
  .page-title {
    font-size: 2.5rem;
  }

  .page-subtitle {
    font-size: 1.1rem;
  }
}
</style>

<script src="/static/js/program-data.js"></script>
<script>
// Load all programs into the program dropdown
document.addEventListener('DOMContentLoaded', function() {
  const programSelect = document.getElementById('program_name');
  
  if (programSelect && typeof allPrograms !== 'undefined') {
    // Clear existing options except the first one
    programSelect.innerHTML = '<option value="">Choose a program...</option>';
    
    // Add all programs from the comprehensive list
    allPrograms.forEach(function(program) {
      const option = document.createElement('option');
      option.value = program;
      option.textContent = program;
      programSelect.appendChild(option);
    });
  }
});

// Restore form values if validation failed
{% if form_data %}
document.addEventListener('DOMContentLoaded', function() {
  const formData = {{ form_data|tojson }};
  
  // Restore specialty
  if (formData.specialty) {
    const specialtySelect = document.getElementById('specialty');
    if (specialtySelect) {
      specialtySelect.value = formData.specialty;
    }
  }
  
  // Restore rating fields
  const ratingFields = ['educational_quality', 'work_life_balance', 'attending_quality', 
                        'facilities_quality', 'research_opportunities', 'culture'];
  ratingFields.forEach(field => {
    if (formData[field]) {
      const select = document.getElementById(field);
      if (select) {
        select.value = formData[field];
      }
    }
  });
  
  // Restore comments
  if (formData.comments) {
    const commentsTextarea = document.getElementById('comments');
    if (commentsTextarea) {
      commentsTextarea.value = formData.comments;
    }
  }
  
  // Restore anonymous checkbox
  if (formData.anonymous) {
    const anonymousCheckbox = document.getElementById('anonymous');
    if (anonymousCheckbox) {
      anonymousCheckbox.checked = true;
    }
  }
  
  // Restore program name (after programs are loaded)
  if (formData.program_name) {
    setTimeout(() => {
      const programSelect = document.getElementById('program_name');
      if (programSelect) {
        // Try to find and select the program
        for (let option of programSelect.options) {
          if (option.value === formData.program_name) {
            option.selected = true;
            break;
          }
        }
      }
    }, 1000); // Wait for programs to load
  }
});
{% endif %}
</script>

{% endblock %}
